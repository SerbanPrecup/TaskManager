{% extends 'base.html' %} {% block title %}Dashboard{% endblock %} {% block head
%} {#
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/dashboard.css') }}"
/>
#} {% endblock %} {% block content %}
<!-- Projects Section -->
<section class="section-title bg-light py-4 position-relative">
  <div
    class="section-header position-absolute top-0 start-50 translate-middle bg-light px-3"
  >
    <h2 class="mb-0 text-primary">Your Projects</h2>
  </div>

  <div class="container-fluid">
    <div class="text-end mb-3">
      <button class="btn btn-primary fixed-btn" onclick="createProject()">
        Add a new project
      </button>
    </div>

    <div class="row flex-row flex-nowrap overflow-auto">
      {% if projects %} {% for project in projects %}
      <div class="col-lg-3 col-md-4 col-sm-6 col-10 mb-3">
        <div class="card h-100">
          <div class="overflow-hidden" style="max-height: 200px">
            <img
              src="{{ url_for('static', filename=project.background_picture) }}"
              class="img-fluid w-100"
              alt="Project Image"
              style="object-fit: cover"
            />
          </div>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ project.name }}</h5>
            <p class="card-text">{{ project.description }}</p>

            {% set status_colors = { 'Not Started': 'secondary', 'In Progress':
            'primary', 'On Hold': 'warning', 'Needs Review': 'info',
            'Completed': 'success', 'Cancelled': 'danger', 'Delayed': 'danger' }
            %}

            <div class="progress mb-2">
              <div
                class="progress-bar bg-{{ status_colors.get(project.status, 'dark') }}"
                role="progressbar"
                style="width: {{ project.progress }}%"
                aria-valuenow="{{ project.progress }}"
                aria-valuemin="0"
                aria-valuemax="100"
              >
                {{ project.progress }}%
              </div>
            </div>

            <span
              class="badge bg-{{ status_colors.get(project.status, 'dark') }}"
              >{{ project.status }}</span
            >

            <p class="card-text mt-2">
              <small class="text-muted"
                >Last updated {{ project.updated_at }}</small
              >
            </p>

            <div class="mt-auto">
              <a
                href="{{ url_for('projects.project_detail', project_id=project.id) }}"
                class="btn btn-primary w-100"
              >
                Go to Project
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %} {% else %}
      <div class="col-12 text-center">
        <h5 class="text-muted">
          You have no projects yet.
          <a href="#" onclick="createProject()">Create a new project</a>.
        </h5>
      </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- Active Tasks Section -->
<section class="section-title bg-light py-4 position-relative">
  <div
    class="section-header position-absolute top-0 start-50 translate-middle bg-light px-3"
  >
    <h2 class="mb-0">Active Tasks</h2>
  </div>

  <div class="container-fluid">
    <div class="row">
      {% if tasks %} {% for task in tasks %} {% set bar_color = 'danger' if
      task.days_left == 0 else 'info' %} {% set status_color = 'secondary' if
      task.status == 'To Do' else 'primary' if task.status == 'In Progress' else
      'success' if task.status == 'Done' else 'dark' %}

      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">{{ task.name }}</h5>
            <p class="card-text">{{ task.description }}</p>

            <div class="position-relative mb-2" style="height: 20px">
              <div class="progress" style="height: 100%">
                <div
                  class="progress-bar bg-{{ bar_color }}"
                  role="progressbar"
                  style="width: {{ task.progress }}%;"
                  aria-valuenow="{{ task.progress }}"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
              <div
                class="position-absolute w-100 text-center"
                style="top: 0; font-size: 0.85rem"
              >
                {% if task.days_left is not none %} {{ task.days_left }} day{{
                's' if task.days_left != 1 else '' }} left {% else %} No
                deadline {% endif %}
              </div>
            </div>

            <p class="card-text">
              <small class="text-muted">
                Deadline: {{ task.deadline.strftime('%Y-%m-%d') if task.deadline
                else 'N/A' }}
              </small>
            </p>

            <p class="mb-2">
              <span class="badge bg-{{ status_color }}">{{ task.status }}</span>
            </p>

            <p>
              <span
                class="badge bg-{{ 'danger' if task.priority == 3 else 'warning' if task.priority == 2 else 'success' }}"
              >
                Priority {{ task.priority }}
              </span>
            </p>

            <a
              href="{{ url_for('projects.project_detail', project_id=task.project.id) }}"
              class="btn btn-primary"
            >
              Go to Project
            </a>
          </div>
        </div>
      </div>
      {% endfor %} {% else %}
      <div class="col-12 text-center">
        <p class="text-muted">You have no active tasks assigned.</p>
      </div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/create-project.js') }}"></script>
{% endblock %}
